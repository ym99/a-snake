<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="cache-control" content="max-age=0"/>
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="viewport" content="width=350">

        <style>
            html, body {
                margin: 0;
            }
            #main {
                margin: 0;
                border-collapse: separate;
                border-spacing: 1;
            }

            #main td {
                width: 10px;
                height: 10px;
                border: solid 1px #ffffff;
                border-radius: 5px;
            }

            #main td.snake-head {
                border: solid 1px #777777;
                background-color: #777777;
            }

            #main td.snake-body {
                border: solid 1px #aaaaaa;
                background-color: #aaaaaa;
            }
        </style>
        <script>
            document.addEventListener('DOMContentLoaded', function(){
                const board = (() => { 
                    const table = document.getElementById("main");

                    // cleaning
                    while (table.rows.length > 0) {
                        table.deleteRow(-1);
                    }

                    // initalizing the table
                    const cellSize = 10;

                    const xCount = Math.floor(window.innerWidth / (cellSize + 1));
                    const yCount = Math.floor(window.innerHeight / (cellSize + 1));

                    for(let y = 0; y < yCount; y++)
                    {
                        const row = table.insertRow(y);

                        for(let x = 0; x < xCount; x++)
                        {
                            const cell = row.insertCell(x);
                        }
                    }

                    return {
                        width: () => table.rows[0].cells.length,
                        height: () => table.rows.length,

                        drawSnake: (snake, keepTailTip = true) => {
                            for(let i = 0; i < snake.length; i++) {
                                const classList = table.rows[snake[i].y].cells[snake[i].x].classList;
                                if (i === 0) {
                                    classList.remove('snake-body');
                                    classList.add('snake-head');
                                } else if (i < snake.length - 1 || keepTailTip) {
                                    classList.remove('snake-head');
                                    classList.add('snake-body');
                                } else {
                                    classList.remove('snake-body', 'snake-head');
                                }
                            }
                        }
                    };
                })();

                function createRandomPoint() {
                    return {
                        x: Math.floor(Math.random() * board.width()),
                        y: Math.floor(Math.random() * board.height())
                    };
                }

                function createPoint({x, y}, {deltaX, deltaY}) {
                    return {
                        x: x + deltaX,
                        y: y + deltaY,
                    }
                }

                const snake = ((size) => {
                    const result = [createRandomPoint()];
                    const preferX = Math.random() >= 0.5;
                    const delta = {
                        deltaX:  preferX ? Math.random() >= 0.5 ? 1 : -1 : 0,
                        deltaY: !preferX ? Math.random() >= 0.5 ? 1 : -1 : 0,
                    };
                    for(let i = 1; i < size; i++) {
                        const last = result[result.length - 1];
                        if (last.x + delta.deltaX < 0 || last.x + delta.deltaX >= board.width()) {
                            delta.deltaX = 0;
                            delta.deltaY = 
                                last.y === 0 ? 1 : 
                                last.y === board.height() - 1 ? -1 :
                                    Math.random() >= 0.5 ? 1 : -1;
                        }

                        if (last.y + delta.deltaY < 0 || last.y + delta.deltaY >= board.height()) {
                            delta.deltaX = 
                                last.x === 0 ? 1 : 
                                last.x === board.width() - 1 ? -1 :
                                    Math.random() >= 0.5 ? 1 : -1;
                            delta.deltaY = 0;
                        }

                        result.push(createPoint(last, delta));
                    }

                    return result;
                })(3);

                board.drawSnake(snake);

                const delta = {
                    deltaX: 1,
                    deltaY: 0,
                };

                window.setInterval(() => {
                    snake.unshift(createPoint(snake[0], delta));
                    board.drawSnake(snake, false);
                    snake.pop();
                }, 1000);

            }, false);
        </script>
    </head>
    <body>
        <table id="main"></table>
    </body>
</html>