<html>
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="cache-control" content="max-age=0"/>
        <meta http-equiv="cache-control" content="no-cache" />
        <meta http-equiv="expires" content="0" />
        <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT"/>
        <meta http-equiv="pragma" content="no-cache" />
        <meta name="viewport" content="width=350">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

        <style>
        body {
            margin: 0;
        }

        .eating-apple {
            background-color: #09ff00;
        }

        .eating-self {
            background-color: red;
        }

        #main {
            border-spacing: 0; 
            border-collapse: separate;
            
        }

        #main td{
            border: solid 1px #ffffff;
            width: 20px;
            height: 20px;
        
            border-radius: 10px;
        }

        #main td.snake-head {
            background-color: #646601;
            border: solid 1px #646601;
        }
        
        #main td.snake-body{
            border: solid 1px #015e01;
            background-color: #015e01;
        }     
        
        #main td.apple{
            border: solid 1px #00d600;
            background-color: #00d600;
        }

        #up, #down, #left, #right, #slower, #faster {
            position: absolute;
            font-size: 25vh;
            text-align: center;
            opacity: 0.1;
        }
        
        #up.clicked, #down.clicked, #left.clicked, #right.clicked, #slower.clicked, #faster.clicked {
            opacity: 0.3;
        }

        #left i, #right i {
            transform: translateY(50%);
        }
        
       </style>

        <script>
            document.addEventListener("DOMContentLoaded", (event) => {
                function fillTable(){
                    var maxCells = Math.floor(window.innerWidth / 20);
                    var maxRows = Math.floor(window.innerHeight / 20);
                
                    var r = 0;
                    while(r < maxRows) {
                        var row = table.insertRow(table.rows.length-1);
                        var c = 0;
                        while (c < maxCells){
                            var cell = row.insertCell(row.cells.length-1);
                        
                            c = c + 1;
                        }
                        r = r + 1;  
                    }
                }

                function createApple(){
                    return {
                        x: Math.floor(Math.random() * table.rows[0].cells.length),
                        y: Math.floor(Math.random() * table.rows.length)
                    };
                }

                function clicked (id){
                    document.getElementById(id).classList.add("clicked");
                    window.setTimeout(() => document.getElementById(id).classList.remove("clicked"), 50);
                }
                
                function onUp() {
                    delta = {
                        x: 0,
                        y: -1
                    };
                    clicked("up");
                }

                function onDown() {
                    delta = {
                        x:0,
                        y:1
                    };
                    clicked("down");
                }

                function onLeft() {
                    delta = {
                        x:-1,
                        y:0
                    };
                    clicked("left");
                }

                function onRight() {
                    delta = {
                        x:1,
                        y:0
                    };
                    clicked("right");
                }

                function onSlower(){
                    delay = delay * 2;
                    clicked("slower");
                }

                function onFaster(){
                    delay = delay / 2;
                    clicked("faster");
                }
            
                function createButtons() {
                    var up = document.getElementById("up");
                    up.style.left = window.innerWidth/4;
                    up.style.top = 0;
                    up.style.width = window.innerWidth/2;
                    up.style.height = window.innerHeight/4; 
                    up.addEventListener("click", onUp);

                    var down = document.getElementById("down");
                    down.style.left = window.innerWidth/4;
                    down.style.top = window.innerHeight*3/4 ;
                    down.style.width = window.innerWidth/2;
                    down.style.height = window.innerHeight/4;
                    down.addEventListener("click", onDown);
                    
                    var left = document.getElementById("left");
                    left.style.left = 0;
                    left.style.top = window.innerHeight/4 ;
                    left.style.width = window.innerWidth/4;
                    left.style.height = window.innerHeight/2;
                    left.addEventListener("click", onLeft);

                    var right = document.getElementById("right");
                    right.style.left = window.innerWidth*3/4;
                    right.style.top = window.innerHeight/4 ;
                    right.style.width = window.innerWidth/4;
                    right.style.height = window.innerHeight/2;
                    right.addEventListener("click", onRight);

                    var slower = document.getElementById("slower");
                    slower.style.left = window.innerWidth*3/4;
                    slower.style.top = window.innerHeight*3/4;
                    slower.style.width = window.innerWidth/8;
                    slower.style.height = window.innerHeight/4;
                    slower.addEventListener("click", onSlower);

                    var faster = document.getElementById("faster");
                    faster.style.left = window.innerWidth*7/8;
                    faster.style.top = window.innerHeight*3/4;
                    faster.style.width = window.innerWidth/8;
                    faster.style.height = window.innerHeight/4;
                    faster.addEventListener("click", onFaster);

                    document.body.addEventListener("keydown", (e) => {
                        e = e || window.event;
                        if (e.keyCode === 37) {
                            onLeft();
                        }
                        if (e.keyCode === 38) {
                            onUp();
                        }
                        if (e.keyCode === 39) {
                            onRight();
                        }
                        if (e.keyCode === 40) {
                            onDown();
                        }
                    });
                }

                function showSnake(){
                    var snakeHead = snake[0];
                    var row = table.rows[ snakeHead.y ];
                    var cell = row.cells[ snakeHead.x ];
                    cell.classList.add("snake-head");
                     
                    var i = 1;
                    while (i<snake.length){
                        var snakeBody = snake[i];
                        var row = table.rows[ snakeBody.y ];
                        var cell = row.cells[ snakeBody.x ];
                        cell.classList.add("snake-body");
                        i = i + 1;
                    }    
                }
 
                function hideSnake(){
                    var snakeHead = snake[0];
                    var row = table.rows[ snakeHead.y ];
                    var cell = row.cells[ snakeHead.x ];
                    cell.classList.remove("snake-head", "apple");
                     
                    var i = 1;
                    while (i<snake.length){
                        var snakeBody = snake[i];
                        var row = table.rows[ snakeBody.y ];
                        var cell = row.cells[ snakeBody.x ];
                        cell.classList.remove("snake-body", "apple");
                        i = i + 1;
                    }    
                }

                function onTimer(){
                    hideSnake();
                 
                    var newSnakeHead = {
                        x: snake[0].x + delta.x,
                        y: snake[0].y + delta.y    
                    };

                    if(newSnakeHead.x < 0){
                        newSnakeHead.x = table.rows[0].cells.length-1;
                    }

                    if(newSnakeHead.y < 0){
                        newSnakeHead.y = table.rows.length-1;
                    }

                    if(newSnakeHead.x >= table.rows[0].cells.length){
                        newSnakeHead.x = 0;
                    }
                    
                    if(newSnakeHead.y >= table.rows.length){
                        newSnakeHead.y = 0;
                    }
                    
                    var keepSnakeTail = false;
                    var index = 0;
                    while (index<snake.length){
                        var snakeBody = snake[index];
                        if (snakeBody.x === newSnakeHead.x && snakeBody.y === newSnakeHead.y) {
                            snake.splice(index);
                            keepSnakeTail = true;
                            document.body.classList.add("eating-self");
                            window.setInterval(() => document.body.classList.remove("eating-self"), 100);
                        }
                        index = index + 1;
                    }

                    var addNewApple = false;
                    index = 0;
                    while (index<apples.length){
                        var apple = apples[index];
                        if (newSnakeHead.x === apple.x &&
                            newSnakeHead.y === apple.y) {
                                keepSnakeTail = true;
                                addNewApple = true;
                                apples.splice(index, 1);
                                
                                document.body.classList.add("eating-apple");
                                window.setInterval(() => document.body.classList.remove("eating-apple"), 100);
                        }

                        index = index + 1;
                    }

                    snake.unshift(newSnakeHead);
                    if (keepSnakeTail === false){
                        snake.pop();
                    }
                    
                    showSnake();

                    if (addNewApple) {
                        var positionTaken = false;
                        do 
                        {
                            var apple = createApple();

                            var index = 0;
                            while (index<snake.length){
                                var snakeBody = snake[index];
                                if (snakeBody.x === apple.x && snakeBody.y === apple.y) {
                                    positionTaken = true;
                                }
                                index = index + 1;
                            }

                            index = 0;
                            while (index<apples.length){
                                var oldApple = apples[index];
                                if (oldApple.x === apple.x && oldApple.y === apple.y) {
                                    positionTaken = true;
                                }
                                index = index + 1;
                            }
                        }
                        while (positionTaken);

                        apples.push(apple);
                        var row = table.rows[apple.y];
                        var cell = row.cells[apple.x];
                        cell.classList.add("apple");
                    }

                    window.setTimeout(onTimer, delay);
                }

                var table = document.getElementById("main");

                var snake = [];
                snake.push({
                    x: 10, 
                    y: 10
                });
                snake.push({
                    x: 9,
                    y: 10
                });
                snake.push({
                    x: 8,
                    y: 10
                });

                var delta = {
                    x:1,
                    y:0,
                };

                fillTable();
                createButtons(); 

                var apples = [];
                var index = 0;
                while (index<5){
                    var apple = createApple();
                    apples.push(apple);
                    var row = table.rows[apple.y];
                    var cell = row.cells[apple.x];
                    cell.classList.add("apple");

                    index = index + 1;
                } 

                var delay = 250;

                showSnake();
                
                window.setTimeout(onTimer, delay);
            });
        </script>
    </head>
    <body>
            
        <table id="main"></table>
        <div id = "up">
            <i class="fa fa-chevron-circle-up"></i>
        </div>
        <div id = "down"> 
            <i class="fa fa-chevron-circle-down"></i>
        </div> 
        <div id = "left"> 
            <i class="fa fa-chevron-circle-left"></i>
        </div>
        <div id = "right"> 
            <i class="fa fa-chevron-circle-right"></i>
        </div>

        <dv id = "slower">
            <i class="fa fa-minus-circle"></i>
        </dv>

        <dv id = "faster">
            <i class="fa fa-plus-circle"></i>
        </dv>
        
    </body>

</html>